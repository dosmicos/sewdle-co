import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

// Deprisa only covers main cities (NO COD support)
const DEPRISA_CITIES = new Set([
  'bogota', 'bogotá', 'medellin', 'medellín', 'cali', 'barranquilla', 'cartagena',
  'bucaramanga', 'cucuta', 'cúcuta', 'pereira', 'santa marta', 'ibague', 'ibagué',
  'pasto', 'manizales', 'neiva', 'villavicencio', 'armenia', 'popayan', 'popayán',
  'valledupar', 'monteria', 'montería', 'sincelejo', 'tunja', 'florencia', 'riohacha',
  // Áreas metropolitanas
  'soacha', 'bello', 'itagui', 'itagüí', 'envigado', 'soledad',
  'floridablanca', 'palmira', 'buenaventura', 'dosquebradas',
  // Ciudades intermedias importantes
  'barrancabermeja', 'girardot', 'tulua', 'tuluá', 'apartado', 'apartadó',
  'chia', 'chía', 'zipaquira', 'zipaquirá', 'facatativa', 'facatativá', 
  'funza', 'madrid', 'mosquera'
]);

// Normalize text for comparison
function normalizeText(text: string): string {
  return text.toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .trim();
}

// Determine priority carrier based on location
function determinePriorityCarrier(municipality: string, department: string): string {
  const normMuni = normalizeText(municipality);
  const normDept = normalizeText(department);
  
  // Cundinamarca/Bogotá → Coordinadora
  if (normDept.includes('cundinamarca') || 
      normDept.includes('bogota') || 
      normMuni.includes('bogota')) {
    return 'coordinadora';
  }
  
  // Medellín area → Coordinadora
  if (normDept.includes('antioquia') && 
      (normMuni.includes('medellin') || normMuni.includes('envigado') || 
       normMuni.includes('bello') || normMuni.includes('itagui') || 
       normMuni.includes('sabaneta'))) {
    return 'coordinadora';
  }
  
  // Main cities → Deprisa (for paid orders)
  if (DEPRISA_CITIES.has(normMuni)) {
    return 'deprisa';
  }
  
  // Everything else → InterRapidísimo
  return 'interrapidisimo';
}

// Check if Deprisa covers this municipality
function hasDeprisaCoverage(municipality: string): boolean {
  return DEPRISA_CITIES.has(normalizeText(municipality));
}

// Colombian municipalities data - extracted from CSV
// Format: [department_code, department_name, municipality_name, dane_code]
const COLOMBIA_MUNICIPALITIES: [string, string, string, string][] = [
  // Antioquia
  ["05", "Antioquia", "Medellín", "05001000"],
  ["05", "Antioquia", "Abejorral", "05002000"],
  ["05", "Antioquia", "Abriaquí", "05004000"],
  ["05", "Antioquia", "Alejandría", "05021000"],
  ["05", "Antioquia", "Amagá", "05030000"],
  ["05", "Antioquia", "Amalfi", "05031000"],
  ["05", "Antioquia", "Andes", "05034000"],
  ["05", "Antioquia", "Angelópolis", "05036000"],
  ["05", "Antioquia", "Angostura", "05038000"],
  ["05", "Antioquia", "Anorí", "05040000"],
  ["05", "Antioquia", "Santafé de Antioquia", "05042000"],
  ["05", "Antioquia", "Anzá", "05044000"],
  ["05", "Antioquia", "Apartadó", "05045000"],
  ["05", "Antioquia", "Arboletes", "05051000"],
  ["05", "Antioquia", "Argelia", "05055000"],
  ["05", "Antioquia", "Armenia", "05059000"],
  ["05", "Antioquia", "Barbosa", "05079000"],
  ["05", "Antioquia", "Belmira", "05086000"],
  ["05", "Antioquia", "Bello", "05088000"],
  ["05", "Antioquia", "Betania", "05091000"],
  ["05", "Antioquia", "Betulia", "05093000"],
  ["05", "Antioquia", "Ciudad Bolívar", "05101000"],
  ["05", "Antioquia", "Briceño", "05107000"],
  ["05", "Antioquia", "Buriticá", "05113000"],
  ["05", "Antioquia", "Cáceres", "05120000"],
  ["05", "Antioquia", "Caicedo", "05125000"],
  ["05", "Antioquia", "Caldas", "05129000"],
  ["05", "Antioquia", "Campamento", "05134000"],
  ["05", "Antioquia", "Cañasgordas", "05138000"],
  ["05", "Antioquia", "Caracolí", "05142000"],
  ["05", "Antioquia", "Caramanta", "05145000"],
  ["05", "Antioquia", "Carepa", "05147000"],
  ["05", "Antioquia", "El Carmen de Viboral", "05148000"],
  ["05", "Antioquia", "Carolina", "05150000"],
  ["05", "Antioquia", "Caucasia", "05154000"],
  ["05", "Antioquia", "Chigorodó", "05172000"],
  ["05", "Antioquia", "Cisneros", "05190000"],
  ["05", "Antioquia", "Cocorná", "05197000"],
  ["05", "Antioquia", "Concepción", "05206000"],
  ["05", "Antioquia", "Concordia", "05209000"],
  ["05", "Antioquia", "Copacabana", "05212000"],
  ["05", "Antioquia", "Dabeiba", "05234000"],
  ["05", "Antioquia", "Don Matías", "05237000"],
  ["05", "Antioquia", "Ebéjico", "05240000"],
  ["05", "Antioquia", "El Bagre", "05250000"],
  ["05", "Antioquia", "Entrerrios", "05264000"],
  ["05", "Antioquia", "Envigado", "05266000"],
  ["05", "Antioquia", "Fredonia", "05282000"],
  ["05", "Antioquia", "Frontino", "05284000"],
  ["05", "Antioquia", "Giraldo", "05306000"],
  ["05", "Antioquia", "Girardota", "05308000"],
  ["05", "Antioquia", "Gómez Plata", "05310000"],
  ["05", "Antioquia", "Granada", "05313000"],
  ["05", "Antioquia", "Guadalupe", "05315000"],
  ["05", "Antioquia", "Guarne", "05318000"],
  ["05", "Antioquia", "Guatapé", "05321000"],
  ["05", "Antioquia", "Heliconia", "05347000"],
  ["05", "Antioquia", "Hispania", "05353000"],
  ["05", "Antioquia", "Itagüí", "05360000"],
  ["05", "Antioquia", "Ituango", "05361000"],
  ["05", "Antioquia", "Jardín", "05364000"],
  ["05", "Antioquia", "Jericó", "05368000"],
  ["05", "Antioquia", "La Ceja", "05376000"],
  ["05", "Antioquia", "La Estrella", "05380000"],
  ["05", "Antioquia", "La Pintada", "05390000"],
  ["05", "Antioquia", "La Unión", "05400000"],
  ["05", "Antioquia", "Liborina", "05411000"],
  ["05", "Antioquia", "Maceo", "05425000"],
  ["05", "Antioquia", "Marinilla", "05440000"],
  ["05", "Antioquia", "Montebello", "05467000"],
  ["05", "Antioquia", "Murindó", "05475000"],
  ["05", "Antioquia", "Mutatá", "05480000"],
  ["05", "Antioquia", "Nariño", "05483000"],
  ["05", "Antioquia", "Necoclí", "05490000"],
  ["05", "Antioquia", "Nechí", "05495000"],
  ["05", "Antioquia", "Olaya", "05501000"],
  ["05", "Antioquia", "Peñol", "05541000"],
  ["05", "Antioquia", "Peque", "05543000"],
  ["05", "Antioquia", "Pueblorrico", "05576000"],
  ["05", "Antioquia", "Puerto Berrío", "05579000"],
  ["05", "Antioquia", "Puerto Nare", "05585000"],
  ["05", "Antioquia", "Puerto Triunfo", "05591000"],
  ["05", "Antioquia", "Remedios", "05604000"],
  ["05", "Antioquia", "Retiro", "05607000"],
  ["05", "Antioquia", "Rionegro", "05615000"],
  ["05", "Antioquia", "Sabanalarga", "05628000"],
  ["05", "Antioquia", "Sabaneta", "05631000"],
  ["05", "Antioquia", "Salgar", "05642000"],
  ["05", "Antioquia", "San Andrés de Cuerquía", "05647000"],
  ["05", "Antioquia", "San Carlos", "05649000"],
  ["05", "Antioquia", "San Francisco", "05652000"],
  ["05", "Antioquia", "San Jerónimo", "05656000"],
  ["05", "Antioquia", "San José de La Montaña", "05658000"],
  ["05", "Antioquia", "San Juan de Urabá", "05659000"],
  ["05", "Antioquia", "San Luis", "05660000"],
  ["05", "Antioquia", "San Pedro de Los Milagros", "05664000"],
  ["05", "Antioquia", "San Pedro de Urabá", "05665000"],
  ["05", "Antioquia", "San Rafael", "05667000"],
  ["05", "Antioquia", "San Roque", "05670000"],
  ["05", "Antioquia", "San Vicente", "05674000"],
  ["05", "Antioquia", "Santa Bárbara", "05679000"],
  ["05", "Antioquia", "Santa Rosa de Osos", "05686000"],
  ["05", "Antioquia", "Santo Domingo", "05690000"],
  ["05", "Antioquia", "El Santuario", "05697000"],
  ["05", "Antioquia", "Segovia", "05736000"],
  ["05", "Antioquia", "Sonsón", "05756000"],
  ["05", "Antioquia", "Sopetrán", "05761000"],
  ["05", "Antioquia", "Támesis", "05789000"],
  ["05", "Antioquia", "Tarazá", "05790000"],
  ["05", "Antioquia", "Tarso", "05792000"],
  ["05", "Antioquia", "Titiribí", "05809000"],
  ["05", "Antioquia", "Toledo", "05819000"],
  ["05", "Antioquia", "Turbo", "05837000"],
  ["05", "Antioquia", "Uramita", "05842000"],
  ["05", "Antioquia", "Urrao", "05847000"],
  ["05", "Antioquia", "Valdivia", "05854000"],
  ["05", "Antioquia", "Valparaíso", "05856000"],
  ["05", "Antioquia", "Vegachí", "05858000"],
  ["05", "Antioquia", "Venecia", "05861000"],
  ["05", "Antioquia", "Vigía del Fuerte", "05873000"],
  ["05", "Antioquia", "Yalí", "05885000"],
  ["05", "Antioquia", "Yarumal", "05887000"],
  ["05", "Antioquia", "Yolombó", "05890000"],
  ["05", "Antioquia", "Yondó", "05893000"],
  ["05", "Antioquia", "Zaragoza", "05895000"],
  // Atlántico
  ["08", "Atlántico", "Barranquilla", "08001000"],
  ["08", "Atlántico", "Baranoa", "08078000"],
  ["08", "Atlántico", "Campo de La Cruz", "08137000"],
  ["08", "Atlántico", "Candelaria", "08141000"],
  ["08", "Atlántico", "Galapa", "08296000"],
  ["08", "Atlántico", "Juan de Acosta", "08372000"],
  ["08", "Atlántico", "Luruaco", "08421000"],
  ["08", "Atlántico", "Malambo", "08433000"],
  ["08", "Atlántico", "Manatí", "08436000"],
  ["08", "Atlántico", "Palmar de Varela", "08520000"],
  ["08", "Atlántico", "Piojó", "08549000"],
  ["08", "Atlántico", "Polonuevo", "08558000"],
  ["08", "Atlántico", "Ponedera", "08560000"],
  ["08", "Atlántico", "Puerto Colombia", "08573000"],
  ["08", "Atlántico", "Repelón", "08606000"],
  ["08", "Atlántico", "Sabanagrande", "08634000"],
  ["08", "Atlántico", "Sabanalarga", "08638000"],
  ["08", "Atlántico", "Santa Lucía", "08675000"],
  ["08", "Atlántico", "Santo Tomás", "08685000"],
  ["08", "Atlántico", "Soledad", "08758000"],
  ["08", "Atlántico", "Suan", "08770000"],
  ["08", "Atlántico", "Tubará", "08832000"],
  ["08", "Atlántico", "Usiacurí", "08849000"],
  // Bogotá D.C.
  ["11", "Bogotá D.C.", "Bogotá D.C.", "11001000"],
  // Bolívar
  ["13", "Bolívar", "Cartagena", "13001000"],
  ["13", "Bolívar", "Achí", "13006000"],
  ["13", "Bolívar", "Altos del Rosario", "13030000"],
  ["13", "Bolívar", "Arenal", "13042000"],
  ["13", "Bolívar", "Arjona", "13052000"],
  ["13", "Bolívar", "Arroyohondo", "13062000"],
  ["13", "Bolívar", "Barranco de Loba", "13074000"],
  ["13", "Bolívar", "Calamar", "13140000"],
  ["13", "Bolívar", "Cantagallo", "13160000"],
  ["13", "Bolívar", "Cicuco", "13188000"],
  ["13", "Bolívar", "Córdoba", "13212000"],
  ["13", "Bolívar", "Clemencia", "13222000"],
  ["13", "Bolívar", "El Carmen de Bolívar", "13244000"],
  ["13", "Bolívar", "El Guamo", "13248000"],
  ["13", "Bolívar", "El Peñón", "13268000"],
  ["13", "Bolívar", "Hatillo de Loba", "13300000"],
  ["13", "Bolívar", "Magangué", "13430000"],
  ["13", "Bolívar", "Mahates", "13433000"],
  ["13", "Bolívar", "Margarita", "13440000"],
  ["13", "Bolívar", "María La Baja", "13442000"],
  ["13", "Bolívar", "Montecristo", "13458000"],
  ["13", "Bolívar", "Mompós", "13468000"],
  ["13", "Bolívar", "Morales", "13473000"],
  ["13", "Bolívar", "Norosí", "13490000"],
  ["13", "Bolívar", "Pinillos", "13549000"],
  ["13", "Bolívar", "Regidor", "13580000"],
  ["13", "Bolívar", "Río Viejo", "13600000"],
  ["13", "Bolívar", "San Cristóbal", "13620000"],
  ["13", "Bolívar", "San Estanislao", "13647000"],
  ["13", "Bolívar", "San Fernando", "13650000"],
  ["13", "Bolívar", "San Jacinto", "13654000"],
  ["13", "Bolívar", "San Jacinto del Cauca", "13655000"],
  ["13", "Bolívar", "San Juan Nepomuceno", "13657000"],
  ["13", "Bolívar", "San Martín de Loba", "13667000"],
  ["13", "Bolívar", "San Pablo", "13670000"],
  ["13", "Bolívar", "Santa Catalina", "13673000"],
  ["13", "Bolívar", "Santa Rosa", "13683000"],
  ["13", "Bolívar", "Santa Rosa del Sur", "13688000"],
  ["13", "Bolívar", "Simití", "13744000"],
  ["13", "Bolívar", "Soplaviento", "13760000"],
  ["13", "Bolívar", "Talaigua Nuevo", "13780000"],
  ["13", "Bolívar", "Tiquisio", "13810000"],
  ["13", "Bolívar", "Turbaco", "13836000"],
  ["13", "Bolívar", "Turbaná", "13838000"],
  ["13", "Bolívar", "Villanueva", "13873000"],
  ["13", "Bolívar", "Zambrano", "13894000"],
  // Boyacá
  ["15", "Boyacá", "Tunja", "15001000"],
  ["15", "Boyacá", "Almeida", "15022000"],
  ["15", "Boyacá", "Aquitania", "15047000"],
  ["15", "Boyacá", "Arcabuco", "15051000"],
  ["15", "Boyacá", "Belén", "15087000"],
  ["15", "Boyacá", "Berbeo", "15090000"],
  ["15", "Boyacá", "Betéitiva", "15092000"],
  ["15", "Boyacá", "Boavita", "15097000"],
  ["15", "Boyacá", "Boyacá", "15104000"],
  ["15", "Boyacá", "Briceño", "15106000"],
  ["15", "Boyacá", "Buenavista", "15109000"],
  ["15", "Boyacá", "Busbanzá", "15114000"],
  ["15", "Boyacá", "Caldas", "15131000"],
  ["15", "Boyacá", "Campohermoso", "15135000"],
  ["15", "Boyacá", "Cerinza", "15162000"],
  ["15", "Boyacá", "Chinavita", "15172000"],
  ["15", "Boyacá", "Chiquinquirá", "15176000"],
  ["15", "Boyacá", "Chiscas", "15180000"],
  ["15", "Boyacá", "Chita", "15183000"],
  ["15", "Boyacá", "Chitaraque", "15185000"],
  ["15", "Boyacá", "Chivatá", "15187000"],
  ["15", "Boyacá", "Ciénega", "15189000"],
  ["15", "Boyacá", "Cómbita", "15204000"],
  ["15", "Boyacá", "Coper", "15212000"],
  ["15", "Boyacá", "Corrales", "15215000"],
  ["15", "Boyacá", "Covarachía", "15218000"],
  ["15", "Boyacá", "Cubará", "15223000"],
  ["15", "Boyacá", "Cucaita", "15224000"],
  ["15", "Boyacá", "Cuítiva", "15226000"],
  ["15", "Boyacá", "Chíquiza", "15232000"],
  ["15", "Boyacá", "Chivor", "15236000"],
  ["15", "Boyacá", "Duitama", "15238000"],
  ["15", "Boyacá", "El Cocuy", "15244000"],
  ["15", "Boyacá", "El Espino", "15248000"],
  ["15", "Boyacá", "Firavitoba", "15272000"],
  ["15", "Boyacá", "Floresta", "15276000"],
  ["15", "Boyacá", "Gachantivá", "15293000"],
  ["15", "Boyacá", "Gámeza", "15296000"],
  ["15", "Boyacá", "Garagoa", "15299000"],
  ["15", "Boyacá", "Guacamayas", "15317000"],
  ["15", "Boyacá", "Guateque", "15322000"],
  ["15", "Boyacá", "Guayatá", "15325000"],
  ["15", "Boyacá", "Güicán", "15332000"],
  ["15", "Boyacá", "Iza", "15362000"],
  ["15", "Boyacá", "Jenesano", "15367000"],
  ["15", "Boyacá", "Jericó", "15368000"],
  ["15", "Boyacá", "Labranzagrande", "15377000"],
  ["15", "Boyacá", "La Capilla", "15380000"],
  ["15", "Boyacá", "La Victoria", "15401000"],
  ["15", "Boyacá", "La Uvita", "15403000"],
  ["15", "Boyacá", "Villa de Leyva", "15407000"],
  ["15", "Boyacá", "Macanal", "15425000"],
  ["15", "Boyacá", "Maripí", "15442000"],
  ["15", "Boyacá", "Miraflores", "15455000"],
  ["15", "Boyacá", "Mongua", "15464000"],
  ["15", "Boyacá", "Monguí", "15466000"],
  ["15", "Boyacá", "Moniquirá", "15469000"],
  ["15", "Boyacá", "Motavita", "15476000"],
  ["15", "Boyacá", "Muzo", "15480000"],
  ["15", "Boyacá", "Nobsa", "15491000"],
  ["15", "Boyacá", "Nuevo Colón", "15494000"],
  ["15", "Boyacá", "Oicatá", "15500000"],
  ["15", "Boyacá", "Otanche", "15507000"],
  ["15", "Boyacá", "Pachavita", "15511000"],
  ["15", "Boyacá", "Páez", "15514000"],
  ["15", "Boyacá", "Paipa", "15516000"],
  ["15", "Boyacá", "Pajarito", "15518000"],
  ["15", "Boyacá", "Panqueba", "15522000"],
  ["15", "Boyacá", "Pauna", "15531000"],
  ["15", "Boyacá", "Paya", "15533000"],
  ["15", "Boyacá", "Paz de Río", "15537000"],
  ["15", "Boyacá", "Pesca", "15542000"],
  ["15", "Boyacá", "Pisba", "15550000"],
  ["15", "Boyacá", "Puerto Boyacá", "15572000"],
  ["15", "Boyacá", "Quípama", "15580000"],
  ["15", "Boyacá", "Ramiriquí", "15599000"],
  ["15", "Boyacá", "Ráquira", "15600000"],
  ["15", "Boyacá", "Rondón", "15621000"],
  ["15", "Boyacá", "Saboyá", "15632000"],
  ["15", "Boyacá", "Sáchica", "15638000"],
  ["15", "Boyacá", "Samacá", "15646000"],
  ["15", "Boyacá", "San Eduardo", "15660000"],
  ["15", "Boyacá", "San José de Pare", "15664000"],
  ["15", "Boyacá", "San Luis de Gaceno", "15667000"],
  ["15", "Boyacá", "San Mateo", "15673000"],
  ["15", "Boyacá", "San Miguel de Sema", "15676000"],
  ["15", "Boyacá", "San Pablo de Borbur", "15681000"],
  ["15", "Boyacá", "Santana", "15686000"],
  ["15", "Boyacá", "Santa María", "15690000"],
  ["15", "Boyacá", "Santa Rosa de Viterbo", "15693000"],
  ["15", "Boyacá", "Santa Sofía", "15696000"],
  ["15", "Boyacá", "Sativanorte", "15720000"],
  ["15", "Boyacá", "Sativasur", "15723000"],
  ["15", "Boyacá", "Siachoque", "15740000"],
  ["15", "Boyacá", "Soatá", "15753000"],
  ["15", "Boyacá", "Socotá", "15755000"],
  ["15", "Boyacá", "Socha", "15757000"],
  ["15", "Boyacá", "Sogamoso", "15759000"],
  ["15", "Boyacá", "Somondoco", "15761000"],
  ["15", "Boyacá", "Sora", "15762000"],
  ["15", "Boyacá", "Sotaquirá", "15763000"],
  ["15", "Boyacá", "Soracá", "15764000"],
  ["15", "Boyacá", "Susacón", "15774000"],
  ["15", "Boyacá", "Sutamarchán", "15776000"],
  ["15", "Boyacá", "Sutatenza", "15778000"],
  ["15", "Boyacá", "Tasco", "15790000"],
  ["15", "Boyacá", "Tenza", "15798000"],
  ["15", "Boyacá", "Tibaná", "15804000"],
  ["15", "Boyacá", "Tibasosa", "15806000"],
  ["15", "Boyacá", "Tinjacá", "15808000"],
  ["15", "Boyacá", "Tipacoque", "15810000"],
  ["15", "Boyacá", "Toca", "15814000"],
  ["15", "Boyacá", "Togüí", "15816000"],
  ["15", "Boyacá", "Tópaga", "15820000"],
  ["15", "Boyacá", "Tota", "15822000"],
  ["15", "Boyacá", "Tununguá", "15832000"],
  ["15", "Boyacá", "Turmequé", "15835000"],
  ["15", "Boyacá", "Tuta", "15837000"],
  ["15", "Boyacá", "Tutazá", "15839000"],
  ["15", "Boyacá", "Úmbita", "15842000"],
  ["15", "Boyacá", "Ventaquemada", "15861000"],
  ["15", "Boyacá", "Viracachá", "15879000"],
  ["15", "Boyacá", "Zetaquira", "15897000"],
  // Caldas
  ["17", "Caldas", "Manizales", "17001000"],
  ["17", "Caldas", "Aguadas", "17013000"],
  ["17", "Caldas", "Anserma", "17042000"],
  ["17", "Caldas", "Aranzazu", "17050000"],
  ["17", "Caldas", "Belalcázar", "17088000"],
  ["17", "Caldas", "Chinchiná", "17174000"],
  ["17", "Caldas", "Filadelfia", "17272000"],
  ["17", "Caldas", "La Dorada", "17380000"],
  ["17", "Caldas", "La Merced", "17388000"],
  ["17", "Caldas", "Manzanares", "17433000"],
  ["17", "Caldas", "Marmato", "17442000"],
  ["17", "Caldas", "Marquetalia", "17444000"],
  ["17", "Caldas", "Marulanda", "17446000"],
  ["17", "Caldas", "Neira", "17486000"],
  ["17", "Caldas", "Norcasia", "17495000"],
  ["17", "Caldas", "Pácora", "17513000"],
  ["17", "Caldas", "Palestina", "17524000"],
  ["17", "Caldas", "Pensilvania", "17541000"],
  ["17", "Caldas", "Riosucio", "17614000"],
  ["17", "Caldas", "Risaralda", "17616000"],
  ["17", "Caldas", "Salamina", "17653000"],
  ["17", "Caldas", "Samaná", "17662000"],
  ["17", "Caldas", "San José", "17665000"],
  ["17", "Caldas", "Supía", "17777000"],
  ["17", "Caldas", "Victoria", "17867000"],
  ["17", "Caldas", "Villamaría", "17873000"],
  ["17", "Caldas", "Viterbo", "17877000"],
  // Caquetá
  ["18", "Caquetá", "Florencia", "18001000"],
  ["18", "Caquetá", "Albania", "18029000"],
  ["18", "Caquetá", "Belén de Los Andaquíes", "18094000"],
  ["18", "Caquetá", "Cartagena del Chairá", "18150000"],
  ["18", "Caquetá", "Curillo", "18205000"],
  ["18", "Caquetá", "El Doncello", "18247000"],
  ["18", "Caquetá", "El Paujil", "18256000"],
  ["18", "Caquetá", "La Montañita", "18410000"],
  ["18", "Caquetá", "Milán", "18460000"],
  ["18", "Caquetá", "Morelia", "18479000"],
  ["18", "Caquetá", "Puerto Rico", "18592000"],
  ["18", "Caquetá", "San José del Fragua", "18610000"],
  ["18", "Caquetá", "San Vicente del Caguán", "18753000"],
  ["18", "Caquetá", "Solano", "18756000"],
  ["18", "Caquetá", "Solita", "18785000"],
  ["18", "Caquetá", "Valparaíso", "18860000"],
  // Cauca
  ["19", "Cauca", "Popayán", "19001000"],
  ["19", "Cauca", "Almaguer", "19022000"],
  ["19", "Cauca", "Argelia", "19050000"],
  ["19", "Cauca", "Balboa", "19075000"],
  ["19", "Cauca", "Bolívar", "19100000"],
  ["19", "Cauca", "Buenos Aires", "19110000"],
  ["19", "Cauca", "Cajibío", "19130000"],
  ["19", "Cauca", "Caldono", "19137000"],
  ["19", "Cauca", "Caloto", "19142000"],
  ["19", "Cauca", "Corinto", "19212000"],
  ["19", "Cauca", "El Tambo", "19256000"],
  ["19", "Cauca", "Florencia", "19290000"],
  ["19", "Cauca", "Guachené", "19300000"],
  ["19", "Cauca", "Guapí", "19318000"],
  ["19", "Cauca", "Inzá", "19355000"],
  ["19", "Cauca", "Jambaló", "19364000"],
  ["19", "Cauca", "La Sierra", "19392000"],
  ["19", "Cauca", "La Vega", "19397000"],
  ["19", "Cauca", "López", "19418000"],
  ["19", "Cauca", "Mercaderes", "19450000"],
  ["19", "Cauca", "Miranda", "19455000"],
  ["19", "Cauca", "Morales", "19473000"],
  ["19", "Cauca", "Padilla", "19513000"],
  ["19", "Cauca", "Páez", "19517000"],
  ["19", "Cauca", "Patía", "19532000"],
  ["19", "Cauca", "Piamonte", "19533000"],
  ["19", "Cauca", "Piendamó", "19548000"],
  ["19", "Cauca", "Puerto Tejada", "19573000"],
  ["19", "Cauca", "Puracé", "19585000"],
  ["19", "Cauca", "Rosas", "19622000"],
  ["19", "Cauca", "San Sebastián", "19693000"],
  ["19", "Cauca", "Santander de Quilichao", "19698000"],
  ["19", "Cauca", "Santa Rosa", "19701000"],
  ["19", "Cauca", "Silvia", "19743000"],
  ["19", "Cauca", "Sotara", "19760000"],
  ["19", "Cauca", "Suárez", "19780000"],
  ["19", "Cauca", "Sucre", "19785000"],
  ["19", "Cauca", "Timbío", "19807000"],
  ["19", "Cauca", "Timbiquí", "19809000"],
  ["19", "Cauca", "Toribío", "19821000"],
  ["19", "Cauca", "Totoró", "19824000"],
  ["19", "Cauca", "Villa Rica", "19845000"],
  // Cesar
  ["20", "Cesar", "Valledupar", "20001000"],
  ["20", "Cesar", "Aguachica", "20011000"],
  ["20", "Cesar", "Agustín Codazzi", "20013000"],
  ["20", "Cesar", "Astrea", "20032000"],
  ["20", "Cesar", "Becerril", "20045000"],
  ["20", "Cesar", "Bosconia", "20060000"],
  ["20", "Cesar", "Chimichagua", "20175000"],
  ["20", "Cesar", "Chiriguaná", "20178000"],
  ["20", "Cesar", "Curumaní", "20228000"],
  ["20", "Cesar", "El Copey", "20238000"],
  ["20", "Cesar", "El Paso", "20250000"],
  ["20", "Cesar", "Gamarra", "20295000"],
  ["20", "Cesar", "González", "20310000"],
  ["20", "Cesar", "La Gloria", "20383000"],
  ["20", "Cesar", "La Jagua de Ibirico", "20400000"],
  ["20", "Cesar", "Manaure", "20443000"],
  ["20", "Cesar", "Pailitas", "20517000"],
  ["20", "Cesar", "Pelaya", "20550000"],
  ["20", "Cesar", "Pueblo Bello", "20570000"],
  ["20", "Cesar", "Río de Oro", "20614000"],
  ["20", "Cesar", "La Paz", "20621000"],
  ["20", "Cesar", "San Alberto", "20710000"],
  ["20", "Cesar", "San Diego", "20750000"],
  ["20", "Cesar", "San Martín", "20770000"],
  ["20", "Cesar", "Tamalameque", "20787000"],
  // Córdoba
  ["23", "Córdoba", "Montería", "23001000"],
  ["23", "Córdoba", "Ayapel", "23068000"],
  ["23", "Córdoba", "Buenavista", "23079000"],
  ["23", "Córdoba", "Canalete", "23090000"],
  ["23", "Córdoba", "Cereté", "23162000"],
  ["23", "Córdoba", "Chimá", "23168000"],
  ["23", "Córdoba", "Chinú", "23182000"],
  ["23", "Córdoba", "Ciénaga de Oro", "23189000"],
  ["23", "Córdoba", "Cotorra", "23300000"],
  ["23", "Córdoba", "La Apartada", "23350000"],
  ["23", "Córdoba", "Lorica", "23417000"],
  ["23", "Córdoba", "Los Córdobas", "23419000"],
  ["23", "Córdoba", "Momil", "23464000"],
  ["23", "Córdoba", "Montelíbano", "23466000"],
  ["23", "Córdoba", "Moñitos", "23500000"],
  ["23", "Córdoba", "Planeta Rica", "23555000"],
  ["23", "Córdoba", "Pueblo Nuevo", "23570000"],
  ["23", "Córdoba", "Puerto Escondido", "23574000"],
  ["23", "Córdoba", "Puerto Libertador", "23580000"],
  ["23", "Córdoba", "Purísima", "23586000"],
  ["23", "Córdoba", "Sahagún", "23660000"],
  ["23", "Córdoba", "San Andrés Sotavento", "23670000"],
  ["23", "Córdoba", "San Antero", "23672000"],
  ["23", "Córdoba", "San Bernardo del Viento", "23675000"],
  ["23", "Córdoba", "San Carlos", "23678000"],
  ["23", "Córdoba", "San José de Uré", "23682000"],
  ["23", "Córdoba", "San Pelayo", "23686000"],
  ["23", "Córdoba", "Tierralta", "23807000"],
  ["23", "Córdoba", "Tuchín", "23815000"],
  ["23", "Córdoba", "Valencia", "23855000"],
  // Cundinamarca
  ["25", "Cundinamarca", "Agua de Dios", "25001000"],
  ["25", "Cundinamarca", "Albán", "25019000"],
  ["25", "Cundinamarca", "Anapoima", "25035000"],
  ["25", "Cundinamarca", "Anolaima", "25040000"],
  ["25", "Cundinamarca", "Arbeláez", "25053000"],
  ["25", "Cundinamarca", "Beltrán", "25086000"],
  ["25", "Cundinamarca", "Bituima", "25095000"],
  ["25", "Cundinamarca", "Bojacá", "25099000"],
  ["25", "Cundinamarca", "Cabrera", "25120000"],
  ["25", "Cundinamarca", "Cachipay", "25123000"],
  ["25", "Cundinamarca", "Cajicá", "25126000"],
  ["25", "Cundinamarca", "Caparrapí", "25148000"],
  ["25", "Cundinamarca", "Cáqueza", "25151000"],
  ["25", "Cundinamarca", "Carmen de Carupa", "25154000"],
  ["25", "Cundinamarca", "Chaguaní", "25168000"],
  ["25", "Cundinamarca", "Chía", "25175000"],
  ["25", "Cundinamarca", "Chipaque", "25178000"],
  ["25", "Cundinamarca", "Choachí", "25181000"],
  ["25", "Cundinamarca", "Chocontá", "25183000"],
  ["25", "Cundinamarca", "Cogua", "25200000"],
  ["25", "Cundinamarca", "Cota", "25214000"],
  ["25", "Cundinamarca", "Cucunubá", "25224000"],
  ["25", "Cundinamarca", "El Colegio", "25245000"],
  ["25", "Cundinamarca", "El Peñón", "25258000"],
  ["25", "Cundinamarca", "El Rosal", "25260000"],
  ["25", "Cundinamarca", "Facatativá", "25269000"],
  ["25", "Cundinamarca", "Fómeque", "25279000"],
  ["25", "Cundinamarca", "Fosca", "25281000"],
  ["25", "Cundinamarca", "Funza", "25286000"],
  ["25", "Cundinamarca", "Fúquene", "25288000"],
  ["25", "Cundinamarca", "Fusagasugá", "25290000"],
  ["25", "Cundinamarca", "Gachalá", "25293000"],
  ["25", "Cundinamarca", "Gachancipá", "25295000"],
  ["25", "Cundinamarca", "Gachetá", "25297000"],
  ["25", "Cundinamarca", "Gama", "25299000"],
  ["25", "Cundinamarca", "Girardot", "25307000"],
  ["25", "Cundinamarca", "Granada", "25312000"],
  ["25", "Cundinamarca", "Guachetá", "25317000"],
  ["25", "Cundinamarca", "Guaduas", "25320000"],
  ["25", "Cundinamarca", "Guasca", "25322000"],
  ["25", "Cundinamarca", "Guataquí", "25324000"],
  ["25", "Cundinamarca", "Guatavita", "25326000"],
  ["25", "Cundinamarca", "Guayabal de Siquima", "25328000"],
  ["25", "Cundinamarca", "Guayabetal", "25335000"],
  ["25", "Cundinamarca", "Gutiérrez", "25339000"],
  ["25", "Cundinamarca", "Jerusalén", "25368000"],
  ["25", "Cundinamarca", "Junín", "25372000"],
  ["25", "Cundinamarca", "La Calera", "25377000"],
  ["25", "Cundinamarca", "La Mesa", "25386000"],
  ["25", "Cundinamarca", "La Palma", "25394000"],
  ["25", "Cundinamarca", "La Peña", "25398000"],
  ["25", "Cundinamarca", "La Vega", "25402000"],
  ["25", "Cundinamarca", "Lenguazaque", "25407000"],
  ["25", "Cundinamarca", "Machetá", "25426000"],
  ["25", "Cundinamarca", "Madrid", "25430000"],
  ["25", "Cundinamarca", "Manta", "25436000"],
  ["25", "Cundinamarca", "Medina", "25438000"],
  ["25", "Cundinamarca", "Mosquera", "25473000"],
  ["25", "Cundinamarca", "Nariño", "25483000"],
  ["25", "Cundinamarca", "Nemocón", "25486000"],
  ["25", "Cundinamarca", "Nilo", "25488000"],
  ["25", "Cundinamarca", "Nimaima", "25489000"],
  ["25", "Cundinamarca", "Nocaima", "25491000"],
  ["25", "Cundinamarca", "Venecia", "25506000"],
  ["25", "Cundinamarca", "Pacho", "25513000"],
  ["25", "Cundinamarca", "Paime", "25518000"],
  ["25", "Cundinamarca", "Pandi", "25524000"],
  ["25", "Cundinamarca", "Paratebueno", "25530000"],
  ["25", "Cundinamarca", "Pasca", "25535000"],
  ["25", "Cundinamarca", "Puerto Salgar", "25572000"],
  ["25", "Cundinamarca", "Pulí", "25580000"],
  ["25", "Cundinamarca", "Quebradanegra", "25592000"],
  ["25", "Cundinamarca", "Quetame", "25594000"],
  ["25", "Cundinamarca", "Quipile", "25596000"],
  ["25", "Cundinamarca", "Apulo", "25599000"],
  ["25", "Cundinamarca", "Ricaurte", "25612000"],
  ["25", "Cundinamarca", "San Antonio del Tequendama", "25645000"],
  ["25", "Cundinamarca", "San Bernardo", "25649000"],
  ["25", "Cundinamarca", "San Cayetano", "25653000"],
  ["25", "Cundinamarca", "San Francisco", "25658000"],
  ["25", "Cundinamarca", "San Juan de Río Seco", "25662000"],
  ["25", "Cundinamarca", "Sasaima", "25718000"],
  ["25", "Cundinamarca", "Sesquilé", "25736000"],
  ["25", "Cundinamarca", "Sibaté", "25740000"],
  ["25", "Cundinamarca", "Silvania", "25743000"],
  ["25", "Cundinamarca", "Simijaca", "25745000"],
  ["25", "Cundinamarca", "Soacha", "25754000"],
  ["25", "Cundinamarca", "Sopó", "25758000"],
  ["25", "Cundinamarca", "Subachoque", "25769000"],
  ["25", "Cundinamarca", "Suesca", "25772000"],
  ["25", "Cundinamarca", "Supatá", "25777000"],
  ["25", "Cundinamarca", "Susa", "25779000"],
  ["25", "Cundinamarca", "Sutatausa", "25781000"],
  ["25", "Cundinamarca", "Tabio", "25785000"],
  ["25", "Cundinamarca", "Tausa", "25793000"],
  ["25", "Cundinamarca", "Tena", "25797000"],
  ["25", "Cundinamarca", "Tenjo", "25799000"],
  ["25", "Cundinamarca", "Tibacuy", "25805000"],
  ["25", "Cundinamarca", "Tibirita", "25807000"],
  ["25", "Cundinamarca", "Tocaima", "25815000"],
  ["25", "Cundinamarca", "Tocancipá", "25817000"],
  ["25", "Cundinamarca", "Topaipí", "25823000"],
  ["25", "Cundinamarca", "Ubalá", "25839000"],
  ["25", "Cundinamarca", "Ubaque", "25841000"],
  ["25", "Cundinamarca", "Villa de San Diego de Ubaté", "25843000"],
  ["25", "Cundinamarca", "Une", "25845000"],
  ["25", "Cundinamarca", "Útica", "25851000"],
  ["25", "Cundinamarca", "Vergara", "25862000"],
  ["25", "Cundinamarca", "Vianí", "25867000"],
  ["25", "Cundinamarca", "Villagómez", "25871000"],
  ["25", "Cundinamarca", "Villapinzón", "25873000"],
  ["25", "Cundinamarca", "Villeta", "25875000"],
  ["25", "Cundinamarca", "Viotá", "25878000"],
  ["25", "Cundinamarca", "Yacopí", "25885000"],
  ["25", "Cundinamarca", "Zipacón", "25898000"],
  ["25", "Cundinamarca", "Zipaquirá", "25899000"],
  // Huila
  ["41", "Huila", "Neiva", "41001000"],
  ["41", "Huila", "Acevedo", "41006000"],
  ["41", "Huila", "Agrado", "41013000"],
  ["41", "Huila", "Aipe", "41016000"],
  ["41", "Huila", "Algeciras", "41020000"],
  ["41", "Huila", "Altamira", "41026000"],
  ["41", "Huila", "Baraya", "41078000"],
  ["41", "Huila", "Campoalegre", "41132000"],
  ["41", "Huila", "Colombia", "41206000"],
  ["41", "Huila", "Elías", "41244000"],
  ["41", "Huila", "Garzón", "41298000"],
  ["41", "Huila", "Gigante", "41306000"],
  ["41", "Huila", "Guadalupe", "41319000"],
  ["41", "Huila", "Hobo", "41349000"],
  ["41", "Huila", "Iquira", "41357000"],
  ["41", "Huila", "Isnos", "41359000"],
  ["41", "Huila", "La Argentina", "41378000"],
  ["41", "Huila", "La Plata", "41396000"],
  ["41", "Huila", "Nátaga", "41483000"],
  ["41", "Huila", "Oporapa", "41503000"],
  ["41", "Huila", "Paicol", "41518000"],
  ["41", "Huila", "Palermo", "41524000"],
  ["41", "Huila", "Palestina", "41530000"],
  ["41", "Huila", "Pital", "41548000"],
  ["41", "Huila", "Pitalito", "41551000"],
  ["41", "Huila", "Rivera", "41615000"],
  ["41", "Huila", "Saladoblanco", "41660000"],
  ["41", "Huila", "San Agustín", "41668000"],
  ["41", "Huila", "Santa María", "41676000"],
  ["41", "Huila", "Suaza", "41770000"],
  ["41", "Huila", "Tarqui", "41791000"],
  ["41", "Huila", "Tesalia", "41797000"],
  ["41", "Huila", "Tello", "41799000"],
  ["41", "Huila", "Teruel", "41801000"],
  ["41", "Huila", "Timaná", "41807000"],
  ["41", "Huila", "Villavieja", "41872000"],
  ["41", "Huila", "Yaguará", "41885000"],
  // La Guajira
  ["44", "La Guajira", "Riohacha", "44001000"],
  ["44", "La Guajira", "Albania", "44035000"],
  ["44", "La Guajira", "Barrancas", "44078000"],
  ["44", "La Guajira", "Dibulla", "44090000"],
  ["44", "La Guajira", "Distracción", "44098000"],
  ["44", "La Guajira", "El Molino", "44110000"],
  ["44", "La Guajira", "Fonseca", "44279000"],
  ["44", "La Guajira", "Hatonuevo", "44378000"],
  ["44", "La Guajira", "La Jagua del Pilar", "44420000"],
  ["44", "La Guajira", "Maicao", "44430000"],
  ["44", "La Guajira", "Manaure", "44560000"],
  ["44", "La Guajira", "San Juan del Cesar", "44650000"],
  ["44", "La Guajira", "Uribia", "44847000"],
  ["44", "La Guajira", "Urumita", "44855000"],
  ["44", "La Guajira", "Villanueva", "44874000"],
  // Magdalena
  ["47", "Magdalena", "Santa Marta", "47001000"],
  ["47", "Magdalena", "Algarrobo", "47030000"],
  ["47", "Magdalena", "Aracataca", "47053000"],
  ["47", "Magdalena", "Ariguaní", "47058000"],
  ["47", "Magdalena", "Cerro San Antonio", "47161000"],
  ["47", "Magdalena", "Chivolo", "47170000"],
  ["47", "Magdalena", "Ciénaga", "47189000"],
  ["47", "Magdalena", "Concordia", "47205000"],
  ["47", "Magdalena", "El Banco", "47245000"],
  ["47", "Magdalena", "El Piñon", "47258000"],
  ["47", "Magdalena", "El Retén", "47268000"],
  ["47", "Magdalena", "Fundación", "47288000"],
  ["47", "Magdalena", "Guamal", "47318000"],
  ["47", "Magdalena", "Nueva Granada", "47460000"],
  ["47", "Magdalena", "Pedraza", "47541000"],
  ["47", "Magdalena", "Pijiño del Carmen", "47545000"],
  ["47", "Magdalena", "Pivijay", "47551000"],
  ["47", "Magdalena", "Plato", "47555000"],
  ["47", "Magdalena", "Puebloviejo", "47570000"],
  ["47", "Magdalena", "Remolino", "47605000"],
  ["47", "Magdalena", "Sabanas de San Ángel", "47660000"],
  ["47", "Magdalena", "Salamina", "47675000"],
  ["47", "Magdalena", "San Sebastián de Buenavista", "47692000"],
  ["47", "Magdalena", "San Zenón", "47703000"],
  ["47", "Magdalena", "Santa Ana", "47707000"],
  ["47", "Magdalena", "Santa Bárbara de Pinto", "47720000"],
  ["47", "Magdalena", "Sitionuevo", "47745000"],
  ["47", "Magdalena", "Tenerife", "47798000"],
  ["47", "Magdalena", "Zapayán", "47960000"],
  ["47", "Magdalena", "Zona Bananera", "47980000"],
  // Meta
  ["50", "Meta", "Villavicencio", "50001000"],
  ["50", "Meta", "Acacías", "50006000"],
  ["50", "Meta", "Barranca de Upía", "50110000"],
  ["50", "Meta", "Cabuyaro", "50124000"],
  ["50", "Meta", "Castilla la Nueva", "50150000"],
  ["50", "Meta", "Cubarral", "50223000"],
  ["50", "Meta", "Cumaral", "50226000"],
  ["50", "Meta", "El Calvario", "50245000"],
  ["50", "Meta", "El Castillo", "50251000"],
  ["50", "Meta", "El Dorado", "50270000"],
  ["50", "Meta", "Fuente de Oro", "50287000"],
  ["50", "Meta", "Granada", "50313000"],
  ["50", "Meta", "Guamal", "50318000"],
  ["50", "Meta", "Mapiripán", "50325000"],
  ["50", "Meta", "Mesetas", "50330000"],
  ["50", "Meta", "La Macarena", "50350000"],
  ["50", "Meta", "Uribe", "50370000"],
  ["50", "Meta", "Lejanías", "50400000"],
  ["50", "Meta", "Puerto Concordia", "50450000"],
  ["50", "Meta", "Puerto Gaitán", "50568000"],
  ["50", "Meta", "Puerto López", "50573000"],
  ["50", "Meta", "Puerto Lleras", "50577000"],
  ["50", "Meta", "Puerto Rico", "50590000"],
  ["50", "Meta", "Restrepo", "50606000"],
  ["50", "Meta", "San Carlos de Guaroa", "50680000"],
  ["50", "Meta", "San Juan de Arama", "50683000"],
  ["50", "Meta", "San Juanito", "50686000"],
  ["50", "Meta", "San Martín", "50689000"],
  ["50", "Meta", "Vistahermosa", "50711000"],
  // Nariño
  ["52", "Nariño", "Pasto", "52001000"],
  ["52", "Nariño", "Albán", "52019000"],
  ["52", "Nariño", "Aldana", "52022000"],
  ["52", "Nariño", "Ancuyá", "52036000"],
  ["52", "Nariño", "Arboleda", "52051000"],
  ["52", "Nariño", "Barbacoas", "52079000"],
  ["52", "Nariño", "Belén", "52083000"],
  ["52", "Nariño", "Buesaco", "52110000"],
  ["52", "Nariño", "Colón", "52203000"],
  ["52", "Nariño", "Consaca", "52207000"],
  ["52", "Nariño", "Contadero", "52210000"],
  ["52", "Nariño", "Córdoba", "52215000"],
  ["52", "Nariño", "Cuaspud", "52224000"],
  ["52", "Nariño", "Cumbal", "52227000"],
  ["52", "Nariño", "Cumbitara", "52233000"],
  ["52", "Nariño", "Chachagüí", "52240000"],
  ["52", "Nariño", "El Charco", "52250000"],
  ["52", "Nariño", "El Peñol", "52254000"],
  ["52", "Nariño", "El Rosario", "52256000"],
  ["52", "Nariño", "El Tablón de Gómez", "52258000"],
  ["52", "Nariño", "El Tambo", "52260000"],
  ["52", "Nariño", "Funes", "52287000"],
  ["52", "Nariño", "Guachucal", "52317000"],
  ["52", "Nariño", "Guaitarilla", "52320000"],
  ["52", "Nariño", "Gualmatán", "52323000"],
  ["52", "Nariño", "Iles", "52352000"],
  ["52", "Nariño", "Imués", "52354000"],
  ["52", "Nariño", "Ipiales", "52356000"],
  ["52", "Nariño", "La Cruz", "52378000"],
  ["52", "Nariño", "La Florida", "52381000"],
  ["52", "Nariño", "La Llanada", "52385000"],
  ["52", "Nariño", "La Tola", "52390000"],
  ["52", "Nariño", "La Unión", "52399000"],
  ["52", "Nariño", "Leiva", "52405000"],
  ["52", "Nariño", "Linares", "52411000"],
  ["52", "Nariño", "Los Andes", "52418000"],
  ["52", "Nariño", "Magüi", "52427000"],
  ["52", "Nariño", "Mallama", "52435000"],
  ["52", "Nariño", "Mosquera", "52473000"],
  ["52", "Nariño", "Nariño", "52480000"],
  ["52", "Nariño", "Olaya Herrera", "52490000"],
  ["52", "Nariño", "Ospina", "52506000"],
  ["52", "Nariño", "Francisco Pizarro", "52520000"],
  ["52", "Nariño", "Policarpa", "52540000"],
  ["52", "Nariño", "Potosí", "52560000"],
  ["52", "Nariño", "Providencia", "52565000"],
  ["52", "Nariño", "Puerres", "52573000"],
  ["52", "Nariño", "Pupiales", "52585000"],
  ["52", "Nariño", "Ricaurte", "52612000"],
  ["52", "Nariño", "Roberto Payán", "52621000"],
  ["52", "Nariño", "Samaniego", "52678000"],
  ["52", "Nariño", "Sandoná", "52683000"],
  ["52", "Nariño", "San Bernardo", "52685000"],
  ["52", "Nariño", "San Lorenzo", "52687000"],
  ["52", "Nariño", "San Pablo", "52693000"],
  ["52", "Nariño", "San Pedro de Cartago", "52694000"],
  ["52", "Nariño", "Santa Bárbara", "52696000"],
  ["52", "Nariño", "Santacruz", "52699000"],
  ["52", "Nariño", "Sapuyes", "52720000"],
  ["52", "Nariño", "Taminango", "52786000"],
  ["52", "Nariño", "Tangua", "52788000"],
  ["52", "Nariño", "San Andres de Tumaco", "52835000"],
  ["52", "Nariño", "Túquerres", "52838000"],
  ["52", "Nariño", "Yacuanquer", "52885000"],
  // Norte de Santander
  ["54", "Norte de Santander", "Cúcuta", "54001000"],
  ["54", "Norte de Santander", "Ábrego", "54003000"],
  ["54", "Norte de Santander", "Arboledas", "54051000"],
  ["54", "Norte de Santander", "Bochalema", "54099000"],
  ["54", "Norte de Santander", "Bucarasica", "54109000"],
  ["54", "Norte de Santander", "Cácota", "54125000"],
  ["54", "Norte de Santander", "Cachirá", "54128000"],
  ["54", "Norte de Santander", "Chinácota", "54172000"],
  ["54", "Norte de Santander", "Chitagá", "54174000"],
  ["54", "Norte de Santander", "Convención", "54206000"],
  ["54", "Norte de Santander", "Cucutilla", "54223000"],
  ["54", "Norte de Santander", "Durania", "54239000"],
  ["54", "Norte de Santander", "El Carmen", "54245000"],
  ["54", "Norte de Santander", "El Tarra", "54250000"],
  ["54", "Norte de Santander", "El Zulia", "54261000"],
  ["54", "Norte de Santander", "Gramalote", "54313000"],
  ["54", "Norte de Santander", "Hacarí", "54344000"],
  ["54", "Norte de Santander", "Herrán", "54347000"],
  ["54", "Norte de Santander", "Labateca", "54377000"],
  ["54", "Norte de Santander", "La Esperanza", "54385000"],
  ["54", "Norte de Santander", "La Playa", "54398000"],
  ["54", "Norte de Santander", "Los Patios", "54405000"],
  ["54", "Norte de Santander", "Lourdes", "54418000"],
  ["54", "Norte de Santander", "Mutiscua", "54480000"],
  ["54", "Norte de Santander", "Ocaña", "54498000"],
  ["54", "Norte de Santander", "Pamplona", "54518000"],
  ["54", "Norte de Santander", "Pamplonita", "54520000"],
  ["54", "Norte de Santander", "Puerto Santander", "54553000"],
  ["54", "Norte de Santander", "Ragonvalia", "54599000"],
  ["54", "Norte de Santander", "Salazar", "54660000"],
  ["54", "Norte de Santander", "San Calixto", "54670000"],
  ["54", "Norte de Santander", "San Cayetano", "54673000"],
  ["54", "Norte de Santander", "Santiago", "54680000"],
  ["54", "Norte de Santander", "Sardinata", "54720000"],
  ["54", "Norte de Santander", "Silos", "54743000"],
  ["54", "Norte de Santander", "Teorama", "54800000"],
  ["54", "Norte de Santander", "Tibú", "54810000"],
  ["54", "Norte de Santander", "Toledo", "54820000"],
  ["54", "Norte de Santander", "Villa Caro", "54871000"],
  ["54", "Norte de Santander", "Villa del Rosario", "54874000"],
  // Quindío
  ["63", "Quindío", "Armenia", "63001000"],
  ["63", "Quindío", "Buenavista", "63111000"],
  ["63", "Quindío", "Calarcá", "63130000"],
  ["63", "Quindío", "Circasia", "63190000"],
  ["63", "Quindío", "Córdoba", "63212000"],
  ["63", "Quindío", "Filandia", "63272000"],
  ["63", "Quindío", "Génova", "63302000"],
  ["63", "Quindío", "La Tebaida", "63401000"],
  ["63", "Quindío", "Montenegro", "63470000"],
  ["63", "Quindío", "Pijao", "63548000"],
  ["63", "Quindío", "Quimbaya", "63594000"],
  ["63", "Quindío", "Salento", "63690000"],
  // Risaralda
  ["66", "Risaralda", "Pereira", "66001000"],
  ["66", "Risaralda", "Apía", "66045000"],
  ["66", "Risaralda", "Balboa", "66075000"],
  ["66", "Risaralda", "Belén de Umbría", "66088000"],
  ["66", "Risaralda", "Dosquebradas", "66170000"],
  ["66", "Risaralda", "Guática", "66318000"],
  ["66", "Risaralda", "La Celia", "66383000"],
  ["66", "Risaralda", "La Virginia", "66400000"],
  ["66", "Risaralda", "Marsella", "66440000"],
  ["66", "Risaralda", "Mistrató", "66456000"],
  ["66", "Risaralda", "Pueblo Rico", "66572000"],
  ["66", "Risaralda", "Quinchía", "66594000"],
  ["66", "Risaralda", "Santa Rosa de Cabal", "66682000"],
  ["66", "Risaralda", "Santuario", "66687000"],
  // Santander
  ["68", "Santander", "Bucaramanga", "68001000"],
  ["68", "Santander", "Aguada", "68013000"],
  ["68", "Santander", "Albania", "68020000"],
  ["68", "Santander", "Aratoca", "68051000"],
  ["68", "Santander", "Barbosa", "68077000"],
  ["68", "Santander", "Barichara", "68079000"],
  ["68", "Santander", "Barrancabermeja", "68081000"],
  ["68", "Santander", "Betulia", "68092000"],
  ["68", "Santander", "Bolívar", "68101000"],
  ["68", "Santander", "Cabrera", "68121000"],
  ["68", "Santander", "California", "68132000"],
  ["68", "Santander", "Capitanejo", "68147000"],
  ["68", "Santander", "Carcasí", "68152000"],
  ["68", "Santander", "Cepitá", "68160000"],
  ["68", "Santander", "Cerrito", "68162000"],
  ["68", "Santander", "Charalá", "68167000"],
  ["68", "Santander", "Charta", "68169000"],
  ["68", "Santander", "Chima", "68176000"],
  ["68", "Santander", "Chipatá", "68179000"],
  ["68", "Santander", "Cimitarra", "68190000"],
  ["68", "Santander", "Concepción", "68207000"],
  ["68", "Santander", "Confines", "68209000"],
  ["68", "Santander", "Contratación", "68211000"],
  ["68", "Santander", "Coromoro", "68217000"],
  ["68", "Santander", "Curití", "68229000"],
  ["68", "Santander", "El Carmen de Chucurí", "68235000"],
  ["68", "Santander", "El Guacamayo", "68245000"],
  ["68", "Santander", "El Peñón", "68250000"],
  ["68", "Santander", "El Playón", "68255000"],
  ["68", "Santander", "Encino", "68264000"],
  ["68", "Santander", "Enciso", "68266000"],
  ["68", "Santander", "Florián", "68271000"],
  ["68", "Santander", "Floridablanca", "68276000"],
  ["68", "Santander", "Galán", "68296000"],
  ["68", "Santander", "Gámbita", "68298000"],
  ["68", "Santander", "Girón", "68307000"],
  ["68", "Santander", "Guaca", "68318000"],
  ["68", "Santander", "Guadalupe", "68320000"],
  ["68", "Santander", "Guapotá", "68322000"],
  ["68", "Santander", "Guavatá", "68324000"],
  ["68", "Santander", "Güepsa", "68327000"],
  ["68", "Santander", "Hato", "68344000"],
  ["68", "Santander", "Jesús María", "68368000"],
  ["68", "Santander", "Jordán", "68370000"],
  ["68", "Santander", "La Belleza", "68377000"],
  ["68", "Santander", "Landázuri", "68385000"],
  ["68", "Santander", "La Paz", "68397000"],
  ["68", "Santander", "Lebríja", "68406000"],
  ["68", "Santander", "Los Santos", "68418000"],
  ["68", "Santander", "Macaravita", "68425000"],
  ["68", "Santander", "Málaga", "68432000"],
  ["68", "Santander", "Matanza", "68444000"],
  ["68", "Santander", "Mogotes", "68464000"],
  ["68", "Santander", "Molagavita", "68468000"],
  ["68", "Santander", "Ocamonte", "68498000"],
  ["68", "Santander", "Oiba", "68500000"],
  ["68", "Santander", "Onzaga", "68502000"],
  ["68", "Santander", "Palmar", "68522000"],
  ["68", "Santander", "Palmas del Socorro", "68524000"],
  ["68", "Santander", "Páramo", "68533000"],
  ["68", "Santander", "Piedecuesta", "68547000"],
  ["68", "Santander", "Pinchote", "68549000"],
  ["68", "Santander", "Puente Nacional", "68572000"],
  ["68", "Santander", "Puerto Parra", "68573000"],
  ["68", "Santander", "Puerto Wilches", "68575000"],
  ["68", "Santander", "Rionegro", "68615000"],
  ["68", "Santander", "Sabana de Torres", "68655000"],
  ["68", "Santander", "San Andrés", "68669000"],
  ["68", "Santander", "San Benito", "68673000"],
  ["68", "Santander", "San Gil", "68679000"],
  ["68", "Santander", "San Joaquín", "68682000"],
  ["68", "Santander", "San José de Miranda", "68684000"],
  ["68", "Santander", "San Miguel", "68686000"],
  ["68", "Santander", "San Vicente de Chucurí", "68689000"],
  ["68", "Santander", "Santa Bárbara", "68705000"],
  ["68", "Santander", "Santa Helena del Opón", "68720000"],
  ["68", "Santander", "Simacota", "68745000"],
  ["68", "Santander", "Socorro", "68755000"],
  ["68", "Santander", "Suaita", "68770000"],
  ["68", "Santander", "Sucre", "68773000"],
  ["68", "Santander", "Suratá", "68780000"],
  ["68", "Santander", "Tona", "68820000"],
  ["68", "Santander", "Valle de San José", "68855000"],
  ["68", "Santander", "Vélez", "68861000"],
  ["68", "Santander", "Vetas", "68867000"],
  ["68", "Santander", "Villanueva", "68872000"],
  ["68", "Santander", "Zapatoca", "68895000"],
  // Sucre
  ["70", "Sucre", "Sincelejo", "70001000"],
  ["70", "Sucre", "Buenavista", "70110000"],
  ["70", "Sucre", "Caimito", "70124000"],
  ["70", "Sucre", "Chalán", "70204000"],
  ["70", "Sucre", "Coloso", "70215000"],
  ["70", "Sucre", "Corozal", "70221000"],
  ["70", "Sucre", "Coveñas", "70230000"],
  ["70", "Sucre", "El Roble", "70233000"],
  ["70", "Sucre", "Galeras", "70235000"],
  ["70", "Sucre", "Guaranda", "70265000"],
  ["70", "Sucre", "La Unión", "70400000"],
  ["70", "Sucre", "Los Palmitos", "70418000"],
  ["70", "Sucre", "Majagual", "70429000"],
  ["70", "Sucre", "Morroa", "70473000"],
  ["70", "Sucre", "Ovejas", "70508000"],
  ["70", "Sucre", "Palmito", "70523000"],
  ["70", "Sucre", "Sampués", "70670000"],
  ["70", "Sucre", "San Benito Abad", "70678000"],
  ["70", "Sucre", "San Juan de Betulia", "70702000"],
  ["70", "Sucre", "San Marcos", "70708000"],
  ["70", "Sucre", "San Onofre", "70713000"],
  ["70", "Sucre", "San Pedro", "70717000"],
  ["70", "Sucre", "San Luis de Sincé", "70742000"],
  ["70", "Sucre", "Sucre", "70771000"],
  ["70", "Sucre", "Santiago de Tolú", "70820000"],
  ["70", "Sucre", "Tolú Viejo", "70823000"],
  // Tolima
  ["73", "Tolima", "Ibagué", "73001000"],
  ["73", "Tolima", "Alpujarra", "73024000"],
  ["73", "Tolima", "Alvarado", "73026000"],
  ["73", "Tolima", "Ambalema", "73030000"],
  ["73", "Tolima", "Anzoátegui", "73043000"],
  ["73", "Tolima", "Armero", "73055000"],
  ["73", "Tolima", "Ataco", "73067000"],
  ["73", "Tolima", "Cajamarca", "73124000"],
  ["73", "Tolima", "Carmen de Apicalá", "73148000"],
  ["73", "Tolima", "Casabianca", "73152000"],
  ["73", "Tolima", "Chaparral", "73168000"],
  ["73", "Tolima", "Coello", "73200000"],
  ["73", "Tolima", "Coyaima", "73217000"],
  ["73", "Tolima", "Cunday", "73226000"],
  ["73", "Tolima", "Dolores", "73236000"],
  ["73", "Tolima", "Espinal", "73268000"],
  ["73", "Tolima", "Falan", "73270000"],
  ["73", "Tolima", "Flandes", "73275000"],
  ["73", "Tolima", "Fresno", "73283000"],
  ["73", "Tolima", "Guamo", "73319000"],
  ["73", "Tolima", "Herveo", "73347000"],
  ["73", "Tolima", "Honda", "73349000"],
  ["73", "Tolima", "Icononzo", "73352000"],
  ["73", "Tolima", "Lérida", "73408000"],
  ["73", "Tolima", "Líbano", "73411000"],
  ["73", "Tolima", "San Sebastián de Mariquita", "73443000"],
  ["73", "Tolima", "Melgar", "73449000"],
  ["73", "Tolima", "Murillo", "73461000"],
  ["73", "Tolima", "Natagaima", "73483000"],
  ["73", "Tolima", "Ortega", "73504000"],
  ["73", "Tolima", "Palocabildo", "73520000"],
  ["73", "Tolima", "Piedras", "73547000"],
  ["73", "Tolima", "Planadas", "73555000"],
  ["73", "Tolima", "Prado", "73563000"],
  ["73", "Tolima", "Purificación", "73585000"],
  ["73", "Tolima", "Rioblanco", "73616000"],
  ["73", "Tolima", "Roncesvalles", "73622000"],
  ["73", "Tolima", "Rovira", "73624000"],
  ["73", "Tolima", "Saldaña", "73671000"],
  ["73", "Tolima", "San Antonio", "73675000"],
  ["73", "Tolima", "San Luis", "73678000"],
  ["73", "Tolima", "Santa Isabel", "73686000"],
  ["73", "Tolima", "Suárez", "73770000"],
  ["73", "Tolima", "Valle de San Juan", "73854000"],
  ["73", "Tolima", "Venadillo", "73861000"],
  ["73", "Tolima", "Villahermosa", "73870000"],
  ["73", "Tolima", "Villarrica", "73873000"],
  // Valle del Cauca
  ["76", "Valle del Cauca", "Cali", "76001000"],
  ["76", "Valle del Cauca", "Alcalá", "76020000"],
  ["76", "Valle del Cauca", "Andalucía", "76036000"],
  ["76", "Valle del Cauca", "Ansermanuevo", "76041000"],
  ["76", "Valle del Cauca", "Argelia", "76054000"],
  ["76", "Valle del Cauca", "Bolívar", "76100000"],
  ["76", "Valle del Cauca", "Buenaventura", "76109000"],
  ["76", "Valle del Cauca", "Guadalajara de Buga", "76111000"],
  ["76", "Valle del Cauca", "Bugalagrande", "76113000"],
  ["76", "Valle del Cauca", "Caicedonia", "76122000"],
  ["76", "Valle del Cauca", "Calima", "76126000"],
  ["76", "Valle del Cauca", "Candelaria", "76130000"],
  ["76", "Valle del Cauca", "Cartago", "76147000"],
  ["76", "Valle del Cauca", "Dagua", "76233000"],
  ["76", "Valle del Cauca", "El Águila", "76243000"],
  ["76", "Valle del Cauca", "El Cairo", "76246000"],
  ["76", "Valle del Cauca", "El Cerrito", "76248000"],
  ["76", "Valle del Cauca", "El Dovio", "76250000"],
  ["76", "Valle del Cauca", "Florida", "76275000"],
  ["76", "Valle del Cauca", "Ginebra", "76306000"],
  ["76", "Valle del Cauca", "Guacarí", "76318000"],
  ["76", "Valle del Cauca", "Jamundí", "76364000"],
  ["76", "Valle del Cauca", "La Cumbre", "76377000"],
  ["76", "Valle del Cauca", "La Unión", "76400000"],
  ["76", "Valle del Cauca", "La Victoria", "76403000"],
  ["76", "Valle del Cauca", "Obando", "76497000"],
  ["76", "Valle del Cauca", "Palmira", "76520000"],
  ["76", "Valle del Cauca", "Pradera", "76563000"],
  ["76", "Valle del Cauca", "Restrepo", "76606000"],
  ["76", "Valle del Cauca", "Riofrío", "76616000"],
  ["76", "Valle del Cauca", "Roldanillo", "76622000"],
  ["76", "Valle del Cauca", "San Pedro", "76670000"],
  ["76", "Valle del Cauca", "Sevilla", "76736000"],
  ["76", "Valle del Cauca", "Toro", "76823000"],
  ["76", "Valle del Cauca", "Trujillo", "76828000"],
  ["76", "Valle del Cauca", "Tuluá", "76834000"],
  ["76", "Valle del Cauca", "Ulloa", "76845000"],
  ["76", "Valle del Cauca", "Versalles", "76863000"],
  ["76", "Valle del Cauca", "Vijes", "76869000"],
  ["76", "Valle del Cauca", "Yotoco", "76890000"],
  ["76", "Valle del Cauca", "Yumbo", "76892000"],
  ["76", "Valle del Cauca", "Zarzal", "76895000"],
  // Arauca
  ["81", "Arauca", "Arauca", "81001000"],
  ["81", "Arauca", "Arauquita", "81065000"],
  ["81", "Arauca", "Cravo Norte", "81220000"],
  ["81", "Arauca", "Fortul", "81300000"],
  ["81", "Arauca", "Puerto Rondón", "81591000"],
  ["81", "Arauca", "Saravena", "81736000"],
  ["81", "Arauca", "Tame", "81794000"],
  // Casanare
  ["85", "Casanare", "Yopal", "85001000"],
  ["85", "Casanare", "Aguazul", "85010000"],
  ["85", "Casanare", "Chámeza", "85015000"],
  ["85", "Casanare", "Hato Corozal", "85125000"],
  ["85", "Casanare", "La Salina", "85136000"],
  ["85", "Casanare", "Maní", "85139000"],
  ["85", "Casanare", "Monterrey", "85162000"],
  ["85", "Casanare", "Nunchía", "85225000"],
  ["85", "Casanare", "Orocué", "85230000"],
  ["85", "Casanare", "Paz de Ariporo", "85250000"],
  ["85", "Casanare", "Pore", "85263000"],
  ["85", "Casanare", "Recetor", "85279000"],
  ["85", "Casanare", "Sabanalarga", "85300000"],
  ["85", "Casanare", "Sácama", "85315000"],
  ["85", "Casanare", "San Luis de Palenque", "85325000"],
  ["85", "Casanare", "Támara", "85400000"],
  ["85", "Casanare", "Tauramena", "85410000"],
  ["85", "Casanare", "Trinidad", "85430000"],
  ["85", "Casanare", "Villanueva", "85440000"],
  // Putumayo
  ["86", "Putumayo", "Mocoa", "86001000"],
  ["86", "Putumayo", "Colón", "86219000"],
  ["86", "Putumayo", "Orito", "86320000"],
  ["86", "Putumayo", "Puerto Asís", "86568000"],
  ["86", "Putumayo", "Puerto Caicedo", "86569000"],
  ["86", "Putumayo", "Puerto Guzmán", "86571000"],
  ["86", "Putumayo", "Leguízamo", "86573000"],
  ["86", "Putumayo", "Sibundoy", "86749000"],
  ["86", "Putumayo", "San Francisco", "86755000"],
  ["86", "Putumayo", "San Miguel", "86757000"],
  ["86", "Putumayo", "Santiago", "86760000"],
  ["86", "Putumayo", "Valle del Guamuez", "86865000"],
  ["86", "Putumayo", "Villagarzón", "86885000"],
  // San Andrés y Providencia
  ["88", "San Andrés y Providencia", "San Andrés", "88001000"],
  ["88", "San Andrés y Providencia", "Providencia", "88564000"],
  // Amazonas
  ["91", "Amazonas", "Leticia", "91001000"],
  ["91", "Amazonas", "El Encanto", "91263000"],
  ["91", "Amazonas", "La Chorrera", "91405000"],
  ["91", "Amazonas", "La Pedrera", "91407000"],
  ["91", "Amazonas", "La Victoria", "91430000"],
  ["91", "Amazonas", "Mirití - Paraná", "91460000"],
  ["91", "Amazonas", "Puerto Alegría", "91530000"],
  ["91", "Amazonas", "Puerto Arica", "91536000"],
  ["91", "Amazonas", "Puerto Nariño", "91540000"],
  ["91", "Amazonas", "Puerto Santander", "91669000"],
  ["91", "Amazonas", "Tarapacá", "91798000"],
  // Guainía
  ["94", "Guainía", "Inírida", "94001000"],
  ["94", "Guainía", "Barranco Minas", "94343000"],
  ["94", "Guainía", "Mapiripana", "94663000"],
  ["94", "Guainía", "San Felipe", "94883000"],
  ["94", "Guainía", "Puerto Colombia", "94884000"],
  ["94", "Guainía", "La Guadalupe", "94885000"],
  ["94", "Guainía", "Cacahual", "94886000"],
  ["94", "Guainía", "Pana Pana", "94887000"],
  ["94", "Guainía", "Morichal", "94888000"],
  // Guaviare
  ["95", "Guaviare", "San José del Guaviare", "95001000"],
  ["95", "Guaviare", "Calamar", "95015000"],
  ["95", "Guaviare", "El Retorno", "95025000"],
  ["95", "Guaviare", "Miraflores", "95200000"],
  // Vaupés
  ["97", "Vaupés", "Mitú", "97001000"],
  ["97", "Vaupés", "Carurú", "97161000"],
  ["97", "Vaupés", "Pacoa", "97511000"],
  ["97", "Vaupés", "Taraira", "97666000"],
  ["97", "Vaupés", "Papunaua", "97777000"],
  ["97", "Vaupés", "Yavaraté", "97889000"],
  // Vichada
  ["99", "Vichada", "Puerto Carreño", "99001000"],
  ["99", "Vichada", "La Primavera", "99524000"],
  ["99", "Vichada", "Santa Rosalía", "99624000"],
  ["99", "Vichada", "Cumaribo", "99773000"],
  // Chocó
  ["27", "Chocó", "Quibdó", "27001000"],
  ["27", "Chocó", "Acandí", "27006000"],
  ["27", "Chocó", "Alto Baudó", "27025000"],
  ["27", "Chocó", "Atrato", "27050000"],
  ["27", "Chocó", "Bagadó", "27073000"],
  ["27", "Chocó", "Bahía Solano", "27075000"],
  ["27", "Chocó", "Bajo Baudó", "27077000"],
  ["27", "Chocó", "Bojaya", "27099000"],
  ["27", "Chocó", "El Cantón del San Pablo", "27135000"],
  ["27", "Chocó", "Carmen del Darién", "27150000"],
  ["27", "Chocó", "Cértegui", "27160000"],
  ["27", "Chocó", "Condoto", "27205000"],
  ["27", "Chocó", "El Carmen de Atrato", "27245000"],
  ["27", "Chocó", "El Litoral del San Juan", "27250000"],
  ["27", "Chocó", "Istmina", "27361000"],
  ["27", "Chocó", "Juradó", "27372000"],
  ["27", "Chocó", "Lloró", "27413000"],
  ["27", "Chocó", "Medio Atrato", "27425000"],
  ["27", "Chocó", "Medio Baudó", "27430000"],
  ["27", "Chocó", "Medio San Juan", "27450000"],
  ["27", "Chocó", "Nóvita", "27491000"],
  ["27", "Chocó", "Nuquí", "27495000"],
  ["27", "Chocó", "Río Iró", "27580000"],
  ["27", "Chocó", "Río Quito", "27600000"],
  ["27", "Chocó", "Riosucio", "27615000"],
  ["27", "Chocó", "San José del Palmar", "27660000"],
  ["27", "Chocó", "Sipí", "27745000"],
  ["27", "Chocó", "Tadó", "27787000"],
  ["27", "Chocó", "Unguía", "27800000"],
  ["27", "Chocó", "Unión Panamericana", "27810000"]
];

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const SUPABASE_URL = Deno.env.get('SUPABASE_URL')!;
    const SUPABASE_SERVICE_ROLE_KEY = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;
    const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY);

    const body = await req.json();
    const { organization_id } = body;

    if (!organization_id) {
      return new Response(
        JSON.stringify({ success: false, error: 'organization_id requerido' }),
        { headers: { ...corsHeaders, 'Content-Type': 'application/json' }, status: 400 }
      );
    }

    console.log(`📍 Populating shipping coverage for organization: ${organization_id}`);

    // Delete existing coverage for this organization
    const { error: deleteError } = await supabase
      .from('shipping_coverage')
      .delete()
      .eq('organization_id', organization_id);

    if (deleteError) {
      console.error('Error deleting existing coverage:', deleteError);
    }

    // Build coverage records
    const coverageRecords = COLOMBIA_MUNICIPALITIES.map(([deptCode, department, municipality, daneCode]) => {
      const hasDeprisa = hasDeprisaCoverage(municipality);
      const priority = determinePriorityCarrier(municipality, department);
      
      return {
        organization_id,
        municipality,
        department,
        dane_code: daneCode,
        postal_code: daneCode, // DANE code as postal code
        coordinadora: true,    // National coverage
        interrapidisimo: true, // National coverage
        deprisa: hasDeprisa,   // Only main cities
        priority_carrier: priority
      };
    });

    console.log(`📦 Inserting ${coverageRecords.length} coverage records...`);

    // Insert in batches of 500
    const BATCH_SIZE = 500;
    let inserted = 0;
    let errors = 0;

    for (let i = 0; i < coverageRecords.length; i += BATCH_SIZE) {
      const batch = coverageRecords.slice(i, i + BATCH_SIZE);
      const { error } = await supabase
        .from('shipping_coverage')
        .insert(batch);

      if (error) {
        console.error(`Error inserting batch ${i / BATCH_SIZE + 1}:`, error);
        errors++;
      } else {
        inserted += batch.length;
        console.log(`✅ Inserted batch ${i / BATCH_SIZE + 1} (${batch.length} records)`);
      }
    }

    const deprisaCount = coverageRecords.filter(r => r.deprisa).length;
    
    console.log(`✅ Population complete: ${inserted} records inserted, ${errors} errors`);
    console.log(`📊 Coverage summary:`);
    console.log(`   - Coordinadora: ${coverageRecords.length} municipalities`);
    console.log(`   - InterRapidísimo: ${coverageRecords.length} municipalities`);
    console.log(`   - Deprisa: ${deprisaCount} municipalities`);

    return new Response(
      JSON.stringify({
        success: true,
        message: `Cobertura poblada exitosamente`,
        stats: {
          total_municipalities: coverageRecords.length,
          coordinadora: coverageRecords.length,
          interrapidisimo: coverageRecords.length,
          deprisa: deprisaCount,
          errors
        }
      }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error: unknown) {
    console.error('❌ Error:', error);
    return new Response(
      JSON.stringify({ success: false, error: error.message }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' }, status: 500 }
    );
  }
});
